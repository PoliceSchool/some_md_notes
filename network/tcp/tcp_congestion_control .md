# 何为TCP拥塞控制？

![img](../images/tcp/tcp_flow_control.png)

**假设主机A向主机B通过TCP协议发送数据,可能由以下两种原因导致网络拥塞:**

1. 此时,网络中的K2节点因为要承接A,M1,M2,M3,M4,M5,M6的数据,可能导致某些数据处理不过来从而导致某些分组的丢失,比如恰好丢掉来自主机A的分组.
2. 主机A和主机B建立好连接之后准备开始通信,主机A会根据主机B的接收窗口大小发送数据,如果主机B的接收窗口过大从而导致主机A一下子发送过多数据至K1造成了网络堵塞,从而导致主机A的分组丢失.

**如果发生了网络堵塞应该如何处理呢?**

1. 不应该继续大量的发送数据,否则成千上万使用TCP协议的主机因为网络堵塞再继续发送重复数据会导致网络崩溃.
2. 应该减少发送数据,然后慢慢增加发送量直到一个新的平衡点

**拥塞控制主要由以下几种方式组成:**

1. 慢开始
2. 拥塞避免
3. 拥塞发生
4. 快速恢复

**实现细节:**

1. 慢开始:连接建立时,发送方采用慢开始策略发送数据
2. 拥塞避免:等到一次性发送的数据量到达一个上限时采用线性增长的方式继续增长
3. 拥塞发生时分情况采用不同的拥塞控制方式:
   * 如果是超时事件导致数据重传,此时网络拥塞可能性较高,因此认为网络拥塞,ssthresh减少为当前窗口的一半,并把发送窗口置为1,采用慢开始方式增大发送窗口的值.
   * 如果是收到3个重复的ACK确认包,此时网络拥塞可能性较低,sthresh减少为当前窗口的一半,并把发送窗口置为当前窗口的一半,采用拥塞避免方式增大发送窗口的值.

**简单讲一下TCP流量控制与拥塞控制的区别:**

* TCP流量控制解决的是主机A和主机B的速率不匹配问题,主机A和主机B的速率在TCP流量控制的作用下是可以达到动态平衡的.如果发送方的发送速率过大,那么数据即使到达接收方也会被丢弃.另外发送方会根据接收方返回的窗口大小动态调节本方发送数据的大小.
* TCP拥塞控制解决的是网络拥塞问题(网络拥塞的判断依据是发生了超时事件).TCP会对每一个发出去的报文进行计时,如果一个报文在一段时间内没有返回ACK报文,那么TCP就认为此时网络拥塞,此时不能继续发送大量的数据,需要减少发送数据量,所以需要进行拥塞控制.

TCP流量控制和拥塞控制感觉是个大坑,还有很多东西没有明白也讲不明白,留着以后慢慢优化吧,占个坑在这里.

参考资料:

https://www.geeksforgeeks.org/tcp-congestion-control/

https://zhangbinalan.gitbooks.io/protocol/content/tcpde_yong_sai_kong_zhi.html

https://mp.weixin.qq.com/s?__biz=Mzg2NzA4MTkxNQ==&mid=2247485204&idx=1&sn=27daef390eec05b3d5db7cebcdcb4b7c&source=41#wechat_redirect

https://coolshell.cn/articles/11609.html