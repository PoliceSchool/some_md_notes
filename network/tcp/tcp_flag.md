TCP协议中的flag含义,翻译自[这里](https://www.geeksforgeeks.org/tcp-flags/)

在TCP连接中,标志位用来指明连接的特殊状态或者提供诸如故障排除等额外的有用信息或者处理特殊的连接.大多数常用的标志位是"SYN","ACK"和"FIN".每一个标志位对应一个比特位.

标志位的类型:

* SYN标志位:这个标志位在建立连接的第一步或者两台主机之间的3次握手中使用.只有在发送端和接收端的第一个packet中才设置这个标志位.这是用来同步序列号的,比如告诉对方它应该得到的序列号.
* ACK标志位:这个标志位用来确认被主机成功接收的数据包.这个标志位只有在acknowledgement number 字段包含一个有效的acknowledgement number (确认序列号)时才会被设置.下图中,接收端在建立连接的第二步中发送了一个ACK=1和SYN=1,用来告诉发送端我已经接收到了初始化的packet了.

注:这里要跟TCP的3次握手相结合,3次握手对应下图中的①②③步骤:

1. 在第①步的时候,发送端想要建立连接,首先随机生成一个初始化的序列号,在下图中是521,这个初始化的序列号将作为发送端第一个segment的编号.随后将SYN标志位设置为1,前面说过只有在建立连接的时候或者3次握手的时候才会将这个标志位设置为1,此时将SYN置为1是为了告诉接收端我要建立一个新连接.值得注意的是此时ACK标志为0,**也就是说在发起一个连接的时候,SYN是1,ACK是0.**
2. 在第②步的时候,接收端收到了发送端的segment,发现SYN是1,ACK是0,表明需要建立一个新连接,如果接收端同意新建连接的话,也会随机生成一个初始化的序列号,这个初始化的序列号将作为接收端第一个segment的编号.同时将SYN和ACK都置为1.ACK置为1是为了告诉发送端我接收到你的请求了.因为TCP是全双工通信,第①步只是发送端到接收端的连接.所以第②步也将SYN置为1是因为接收端也需要跟发送端建立连接,所以将SYN置为1是为了告诉发送端我也要建立一个新连接.**也就是说接收端在同意一个新连接的时候SYN和ACK都为1**.然后接收端再将acknowledgement number设置为522,也就是告诉发送端下一个我想要的segment编号是522(这个编号为522的segment用来确认建立接收端到发送端的连接).
3. 在第③步的时候,发送端接收到了接收端的回应,发现SYN和ACK都为1,说明发送端到接收端的连接已经建立了,然后发送端又发现接收到的segment所期待的编号是522,所以就将sequence number设置为522,并且因为已经成功接收到了接收端的segment,所以将ack置为1,另外将acknowledgement number设置为2001表明发送端下一个想要接受到的segment的编号为2001.此时接收端到发送端的连接已经建立.可以开始真正的数据传输了.
4. 总结:①②步建立发送端到接收端的连接,②③步建立接收端到发送端的连接.

![img](../images/tcp/tcp_flag.png)

* FIN标志位:这个标志位用来终止连接.当发送端已经没有数据需要发送时,它会请求连接的终止.这是发送端最后一次发包.它会释放保留的资源并且优雅的终止连接.

![img](../images/tcp/tcp_flag2.png)