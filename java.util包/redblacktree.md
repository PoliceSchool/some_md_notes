翻译自维基百科:[https://en.wikipedia.org/wiki/Red%E2%80%93black_tree](https://en.wikipedia.org/wiki/Red–black_tree)

# 红黑树的含义

红黑树是一种[自平衡二叉搜索树](https://en.wikipedia.org/wiki/Self-balancing_binary_search_tree),二叉树中的每一个节点都有一位额外的比特位用来表明当前节点的颜色(红色或者黑色).这个额外的比特位用来确保这棵树在插入或者删除操作的时候仍能保持近似平衡.

红黑树通过某种方式将树中的每一个节点染成红色或者黑色,这种方式满足某些特性(下面会谈到这些特性),这些特性共同决定了在最坏的情况下这棵树的不平衡程度.当红黑树被修改之后,这棵树会重排并且重新着色以恢复红黑树特性.这些特性的设计能让红黑树高效的执行树的重排和重新着色操作.

红黑树不是完美平衡的,但是足够让查找时间在 O(log n)内,这里的n就是红黑树中元素的总数.另外,红黑树的插入,删除以及伴随而来的重排和重新着色操作,同样能在 O(log n)时间内完成.

因为红黑树只有两种颜色,所以每个节点只需要一位比特位来存储颜色信息即可.跟经典的[二叉搜索树](https://en.wikipedia.org/wiki/Binary_search_tree)(未着色的树)比起来,除了颜色比特位之外,红黑树不包含其他特殊的信息.所以红黑树的内存占用跟经典的二叉搜索树很类似.大多数情况下,这个额外的比特位能够以不增加额外内存的方式存储.

# 特性

上面谈到了红黑树的特性,红黑树的特性总共有5个.

将下面的特性加在一个[二叉搜索树](https://en.wikipedia.org/wiki/Binary_search_tree)上面时,那这棵树必定是一颗红黑树.

1. 每个节点不是红色就是黑色
2. 根节点必须是黑色.
3. 所有的叶子节点(NIL)是黑色的.
4. 如果一个节点是红色的,那么它的两个孩子均为黑色的.
5. 从给定节点到其任何后代NIL节点的每条路径都包含相同数量的黑色节点

![Diagram of binary tree. The black root node has two red children and four black grandchildren. The child nodes of the grandchildren are black nil pointers or red nodes with black nil pointers.](https://upload.wikimedia.org/wikipedia/commons/thumb/6/66/Red-black_tree_example.svg/500px-Red-black_tree_example.svg.png)

注意,除了第五个约束条件之外,没有其他限制加载黑色节点的子节点上(自己的备注:第一条针对的是所有节点,第二条针对的是根节点,而非根节点的子节点,第三条是叶子节点,叶子节点没有子节点,第四条针对的是红色节点的子节点,而第五条说的是给定节点到其任何NIL后代的子节点里面的黑色节点数量相同,这个给定节点有可能是红色节点,也有可能是黑色节点,所以包括了黑色节点,也就是针对黑色节点的子节点).所以,黑色节点(如叶子节点)可以是黑色节点的子节点 ;例如,每个仅由黑色节点组成的[理想二叉树](https://en.wikipedia.org/wiki/Binary_tree#Types_of_binary_trees)都是一颗红黑树.

以上的5个条件是限制红黑树的关键特性:**从根到最远的叶子的路径的长度不超过从根到最近的叶子的路径的两倍**.

限制结果是红黑树是近似平衡的.由于插入删除和查找之类的操作时间与树的高度成比例,所以理论上在最坏的情况下红黑树依然很高效,这点不像[二叉搜索树](https://en.wikipedia.org/wiki/Red%E2%80%93black_tree).

为什么红黑树的特性能够保证红黑树能够高效的操作呢?这一点我们只需要看第4个和第5个特性就足够了.举个栗子,有颗红黑树T,假设B是第5个特性中的黑色节点的数量.再假设从T的根节点到任一叶子节点的可能最短路径由B个黑色节点组成.长一点的路径可能会比最短路径多一些红色节点(不可能多一些黑色节点).但是,根据第4个特性不可能出现连续的红色节点.因此,忽略黑色的叶子节点,最长的可能路径由2*B个节点组成,分别由红黑节点交替组成(这是最坏情况).如果算上黑色的叶子节点,最长的可能路径由2 * B - 1个节点组成.

总结:最短的路径全都是黑节点,最长的路径红黑节点相间.因为所有从根节点到叶子节点的路径都有相同数量的黑色节点(根据第5个特性),所以红黑树中没有一条路径比其他路径的两倍还有长.

所以,如果插入一个新节点之后,可能会破坏红黑树,也就是说红黑树的某条性质被破坏了,这棵树也不再是一颗红黑树了.所以需要重排和重新着色使得这可能变回红黑树.所以就需要左旋,右旋,变色等操作使得树重新变回红黑树.

